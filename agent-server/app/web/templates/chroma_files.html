<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>按文件查看 - ChromaDB</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-50 text-slate-900">
    <div class="mx-auto max-w-6xl px-4 py-8">
      <div class="flex flex-col gap-3 md:flex-row md:items-start md:justify-between">
        <div>
          <h1 class="text-2xl font-semibold">按文件查看</h1>
          <p class="mt-1 text-sm text-slate-600">
            collection: <span class="font-mono">{{ info.collection_name }}</span>
            · persist: <span class="font-mono">{{ info.persist_dir }}</span>
            {% if info.parent_count is not none %}
              · 父 chunk: <span class="font-semibold">{{ info.parent_count }}</span>
            {% endif %}
          </p>
        </div>
        <div class="flex flex-wrap gap-2">
          <a
            class="rounded-lg bg-slate-900 px-4 py-2 text-sm font-medium text-white hover:bg-slate-800"
            href="/chroma/files"
            >当前视图</a
          >
          <a
            class="rounded-lg border border-slate-200 px-4 py-2 text-sm font-medium text-slate-900 hover:bg-slate-50"
            href="/chroma/chunks"
            >所有 chunks</a
          >
          <form
            action="/chroma/clear"
            method="post"
            onsubmit="return confirm('确认清空所有 chunk 吗？此操作不可恢复。')"
          >
            <button
              class="rounded-lg bg-rose-600 px-4 py-2 text-sm font-medium text-white hover:bg-rose-500"
              type="submit"
            >
              清空所有 chunk
            </button>
          </form>
        </div>
      </div>

      <div class="mt-8 overflow-hidden rounded-xl border border-slate-200 bg-white">
        <div class="px-4 py-3 text-sm font-semibold text-slate-600">基于文件名汇总的父 chunk</div>
        {% if not files %}
          <div class="px-4 py-6 text-sm text-slate-500">当前 collection 没有父 chunk 记录。</div>
        {% else %}
          <div class="overflow-x-auto">
            <table class="w-full table-auto text-sm">
              <thead class="bg-slate-50 text-xs uppercase tracking-wide text-slate-600">
                <tr>
                  <th class="px-4 py-3 text-left">文件名</th>
                  <th class="px-4 py-3 text-left">父 chunk 总数</th>
                  <th class="px-4 py-3 text-left">内容类型</th>
                  <th class="px-4 py-3 text-left">最近更新</th>
                  <th class="px-4 py-3 text-right">操作</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-slate-100">
                {% for f in files %}
                <tr>
                  <td class="px-4 py-3 font-mono text-xs text-slate-700">{{ f.file_name }}</td>
                  <td class="px-4 py-3 font-semibold">{{ f.total_parents }}</td>
                  <td class="px-4 py-3">
                    {% for ct, cnt in f.content_types.items() %}
                      <span class="mr-2 inline-flex items-center rounded-full bg-slate-100 px-2 py-1 text-xs font-mono text-slate-700">{{ ct }}: {{ cnt }}</span>
                    {% endfor %}
                  </td>
                  <td class="px-4 py-3 text-xs text-slate-500">
                    {{ f.latest_created_at or "未知" }}
                  </td>
                  <td class="px-4 py-3 text-right">
                    <div class="flex items-center justify-end gap-2">
                      <a
                        class="text-sm font-medium text-slate-900 hover:underline"
                        href="/chroma/file/{{ f.file_name | urlencode }}"
                        >详情 →</a
                      >
                      <form
                        action="/chroma/file/{{ f.file_name | urlencode }}/delete"
                        method="post"
                        onsubmit="return confirm('确认删除 {{ f.file_name }} 的所有 chunk？此操作不可恢复。')"
                      >
                        <button
                          class="rounded-lg border border-rose-500 px-3 py-1 text-xs font-medium text-rose-600 hover:bg-rose-50"
                          type="submit"
                        >
                          删除
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% endif %}
      </div>
    </div>
  </body>
</html>
